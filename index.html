<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KM CellShopp | High-End Mobile</title>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg: #ffffff;
            --glass: rgba(255, 255, 255, 0.25);
            --border: rgba(255, 255, 255, 0.4);
            --accent: #0071e3;
            --orange: #ff8c00;
            --text: #1d1d1f;
            --subtext: #86868b;
        }

        body.dark-mode {
            --bg: #000000;
            --glass: rgba(28, 28, 30, 0.7);
            --border: rgba(255, 255, 255, 0.1);
            --text: #f5f5f7;
            --subtext: #a1a1a6;
            background: radial-gradient(circle at 20% 30%, #1a1a1a 0%, #000000 50%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; }

        body {
            background-color: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            background: radial-gradient(circle at 20% 30%, #f0f4ff 0%, #ffffff 50%);
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }

        .liquid-blob {
            position: fixed; width: 500px; height: 500px;
            background: linear-gradient(135deg, #d4e0ff 0%, #e8f0ff 100%);
            filter: blur(80px); border-radius: 45% 55% 70% 30% / 30% 60% 40% 70%;
            z-index: -1; top: -10%; right: -10%; animation: liquid 20s infinite alternate;
        }
        
        body.dark-mode .liquid-blob {
            background: linear-gradient(135deg, #1e3a8a 0%, #000000 100%);
            opacity: 0.4;
        }

        @keyframes liquid { from { transform: translate(0,0) rotate(0deg); } to { transform: translate(-10%, 15%) rotate(20deg); } }

        .theme-toggle {
            position: fixed; top: 20px; right: 20px; z-index: 15000;
            background: var(--glass); border: 1px solid var(--border);
            backdrop-filter: blur(10px); padding: 10px; border-radius: 50%;
            cursor: pointer; color: var(--text); display: flex; align-items: center;
        }

        header { padding: 40px 20px; text-align: center; position: relative; }
        .logo-img { height: 180px; margin-bottom: 5px; display: block; margin: 0 auto; object-fit: contain; }
        .brand-logo { 
            font-size: 0.7rem; 
            font-weight: 600; 
            letter-spacing: 1.5px; 
            text-transform: uppercase; 
            color: var(--text);
            opacity: 0.6;
        }

        .cat-scroll {
            display: flex; overflow-x: auto; gap: 10px; padding: 10px 20px;
            scrollbar-width: none; -ms-overflow-style: none;
        }
        .cat-scroll::-webkit-scrollbar { display: none; }
        .cat-item {
            padding: 10px 25px; border-radius: 25px; 
            background: var(--glass); 
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            color: var(--text);
            white-space: nowrap; font-size: 0.9rem; font-weight: 600; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }
        .cat-item.active { background: var(--orange); color: white; border-color: var(--orange); }

        .hero { text-align: center; padding: 10px 0 40px; }
        .hero h1 { font-size: 2.4rem; font-weight: 800; letter-spacing: -1.5px; line-height: 1; color: var(--text); }
        .hero span { display: block; font-size: 1.1rem; color: var(--subtext); margin-top: 8px; }

        .container {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
            padding: 0 15px 120px; max-width: 600px; margin: 0 auto;
        }

        .glass-product {
            background: var(--glass); backdrop-filter: blur(25px) saturate(180%);
            border: 1px solid var(--border); border-radius: 35px;
            padding: 20px 10px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.04);
            transition: all 0.5s cubic-bezier(0.2, 1, 0.3, 1);
            color: var(--text);
        }

        .image-wrapper img { 
            max-width: 90%; height: 160px; object-fit: cover; 
            border-radius: 20px; 
            margin-bottom: 10px;
        }

        .mzn-price { font-size: 1.1rem; font-weight: 800; margin-bottom: 15px; display: block; }
        .buy-btn { background: var(--text); color: var(--bg); padding: 10px 20px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; border: none; cursor: pointer; }

        .ios-dock {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            background: var(--glass); backdrop-filter: blur(20px);
            border: 1px solid var(--border); padding: 12px 30px;
            border-radius: 35px; display: flex; gap: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 10000;
        }
        .dock-item { color: var(--text); display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; }
        .dock-item span { font-size: 0.65rem; font-weight: 700; margin-top: 4px; }
        
        .cart-count {
            position: absolute; top: -5px; right: -5px; background: var(--orange);
            color: white; font-size: 0.6rem; padding: 2px 6px; border-radius: 10px;
        }

        .sheet { position: fixed; bottom: -100%; left: 0; width: 100%; background: var(--glass); backdrop-filter: blur(30px); border-radius: 35px 35px 0 0; padding: 25px; z-index: 11000; transition: bottom 0.5s cubic-bezier(0.16, 1, 0.3, 1); box-shadow: 0 -10px 20px rgba(0,0,0,0.1); color: var(--text); border-top: 1px solid var(--border); }
        .sheet.active { bottom: 0; }
        .close-bar { width: 45px; height: 5px; background: var(--subtext); border-radius: 10px; margin: 0 auto 20px; cursor: pointer; }
        
        .cart-item-row { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); }

        #admin-view { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 20000; padding: 20px 20px 100px; overflow-y: auto; color: var(--text); }
        .order-row { background: var(--glass); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border); }
        .btn-del { background: #ff4444; color: white; padding: 8px 12px; border-radius: 8px; font-size: 0.7rem; border: none; cursor: pointer; }

        input, textarea { width: 100%; padding: 14px; margin: 8px 0; border-radius: 15px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; }
        input:focus { border-color: var(--orange); }

        body.blurred #main-ui { filter: blur(20px); pointer-events: none; }
        
        .admin-nav-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; 
            background: var(--glass); backdrop-filter: blur(20px);
            border-top: 1px solid var(--border); padding: 15px;
            display: flex; justify-content: space-around; z-index: 21000;
        }
        .admin-tab { display: none; }
    </style>
</head>
<body id="body">

    <div class="theme-toggle" onclick="toggleTheme()">
        <i data-lucide="moon" id="theme-icon"></i>
    </div>

    <div class="liquid-blob"></div>

    <div id="main-ui">
        <header>
            <img id="mkt-logo-img" class="logo-img" src="https://via.placeholder.com/150x150?text=LOGO">
            <div class="brand-logo" id="mkt-logo">Carregando...</div>
        </header>

        <div class="cat-scroll" id="mkt-cats"></div>

        <section class="hero">
            <h1 id="mkt-title">Liquid Glass</h1>
            <span id="mkt-slogan">iOS 26 Architecture</span>
        </section>

        <main class="container" id="product-list"></main>
    </div>

    <nav class="ios-dock">
        <div class="dock-item" onclick="openWhatsAppSupport()"><i data-lucide="message-circle"></i><span>Suporte</span></div>
        <div class="dock-item" onclick="openSheet('cart-sheet')">
            <i data-lucide="shopping-cart"></i>
            <span id="cart-badge" class="cart-count">0</span>
            <span>Carrinho</span>
        </div>
        <div class="dock-item" onclick="openSheet('login-sheet')"><i data-lucide="user"></i><span>Restrito</span></div>
    </nav>

    <div class="sheet" id="cart-sheet" style="height: 70%; overflow-y: auto;">
        <div class="close-bar" onclick="closeSheets()"></div>
        <h3>Meu Carrinho</h3>
        <div id="cart-items-container" style="margin-top: 20px;"></div>
        <div id="cart-total" style="margin-top: 20px; font-weight: 800; font-size: 1.2rem; text-align: right;">Total: 0 MT</div>
        <button class="buy-btn" style="width:100%; margin-top:20px; padding: 18px; background: var(--text); color: var(--bg);" onclick="goToCheckout()">Finalizar Compra</button>
    </div>

    <div class="sheet" id="checkout-sheet" style="height: 85%; overflow-y: auto;">
        <div class="close-bar" onclick="closeSheets()"></div>
        <h3>Dados de Entrega</h3>
        <p style="font-size: 0.8rem; color: var(--subtext); margin-bottom: 10px;">Preencha para concluir via WhatsApp</p>
        <input type="text" id="cust-name" placeholder="Seu Nome Completo">
        <input type="text" id="cust-phone" placeholder="Telefone / WhatsApp">
        <input type="text" id="cust-address" placeholder="Bairro, Rua e Casa">
        <textarea id="cust-notes" placeholder="Ponto de Refer√™ncia ou Cor do Item" style="height: 80px;"></textarea>
        <button class="buy-btn" style="width:100%; margin-top:15px; padding: 18px; background: var(--orange); color: white;" onclick="confirmOrder()">Confirmar Pedido</button>
    </div>

    <div class="sheet" id="login-sheet" style="height: 40%;">
        <div class="close-bar" onclick="closeSheets()"></div>
        <h3>Acesso Restrito</h3>
        <input type="text" id="adm-user" placeholder="E-mail (kmcellshopp@gmail.com)">
        <input type="password" id="adm-pass" placeholder="Senha">
        <button class="buy-btn" style="width:100%; margin-top:15px;" onclick="login()">Entrar no Painel</button>
    </div>

    <div id="admin-view">
        <div style="display:flex; justify-content:space-between; align-items:center; background: var(--glass); padding: 15px; border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--border); backdrop-filter: blur(10px);">
            <div>
                <div id="admin-clock" style="font-size: 1.3rem; font-weight: 800; letter-spacing: -1px;">00:00:00</div>
                <div style="font-size: 0.6rem; text-transform: uppercase; opacity: 0.6; font-weight: 700;">Maputo, Mo√ßambique</div>
            </div>
            <button class="buy-btn" style="background: #ff4444; padding: 10px 15px; border-radius: 15px;" onclick="closeAdmin()">
                <i data-lucide="log-out" style="width: 18px; height: 18px; color: white;"></i>
            </button>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <div style="background: var(--glass); padding: 15px; border-radius: 20px; border: 1px solid var(--border);">
                <span style="font-size: 0.6rem; font-weight: 700; opacity: 0.6;">PRODUTOS</span>
                <div id="stat-prod-count" style="font-size: 1.4rem; font-weight: 800;">0</div>
            </div>
            <div style="background: var(--glass); padding: 15px; border-radius: 20px; border: 1px solid var(--border);">
                <span style="font-size: 0.6rem; font-weight: 700; opacity: 0.6;">CATEGORIAS</span>
                <div id="stat-cat-count" style="font-size: 1.4rem; font-weight: 800;">0</div>
            </div>
        </div>

        <div id="tab-produtos" class="admin-tab" style="display:block;">
            <h4 style="margin-bottom:10px;">Novo Produto</h4>
            <div style="background: var(--glass); padding: 15px; border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--border);">
                <input type="text" id="new-p-name" placeholder="Nome do Produto">
                <input type="text" id="new-p-price" placeholder="Pre√ßo (ex: 85.000 MT)">
                <input type="text" id="new-p-cat" placeholder="Categoria">
                <input type="file" id="new-p-file" accept="image/*" style="padding: 10px; font-size: 0.7rem;">
                <button class="buy-btn" style="width:100%; margin-top: 10px;" onclick="addProduct()">Salvar Produto</button>
            </div>
            <div id="admin-product-list"></div>
        </div>

        <div id="tab-perfil" class="admin-tab">
            <h4 style="margin-bottom:10px;">Configura√ß√µes da Loja</h4>
            <input type="text" id="cfg-logo" placeholder="Nome da Empresa">
            <input type="text" id="cfg-title" placeholder="T√≠tulo Principal">
            <input type="text" id="cfg-slogan" placeholder="Slogan">
            <input type="file" id="cfg-file" accept="image/*">
            <button class="buy-btn" style="width:100%; margin-top: 15px;" onclick="saveSettings()">Aplicar Altera√ß√µes</button>
        </div>

        <div id="tab-historico" class="admin-tab">
            <h4 style="margin-bottom:10px;">Hist√≥rico de Pedidos</h4>
            <div id="admin-history-list"></div>
        </div>

        <div class="admin-nav-bar">
            <div class="dock-item" onclick="switchAdminTab('produtos')"><i data-lucide="package"></i><span>Produtos</span></div>
            <div class="dock-item" onclick="switchAdminTab('historico')"><i data-lucide="history"></i><span>Pedidos</span></div>
            <div class="dock-item" onclick="switchAdminTab('perfil')"><i data-lucide="settings"></i><span>Loja</span></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, setDoc, deleteDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZAugsYnhFAEYPeYZ63ZX_zslfT5zi6Bk",
            authDomain: "kmcellshopp-7f9de.firebaseapp.com",
            projectId: "kmcellshopp-7f9de",
            storageBucket: "kmcellshopp-7f9de.firebasestorage.app",
            messagingSenderId: "308485504107",
            appId: "1:308485504107:web:99dbca7944e682a710852e",
            measurementId: "G-X9RVT0M8W1"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Global Variables
        window.cart = [];
        window.products = [];
        window.historyData = [];
        window.settings = { title: 'Liquid Glass', slogan: 'iOS 26 Architecture', logo: 'Goddid Solu√ß√µes', logoImg: '' };
        window.currentProductImg = "";
        window.currentLogoImg = "";

        // Sync Products
        onSnapshot(collection(db, "products"), (snapshot) => {
            window.products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderMarketplace();
            renderAdminProducts();
        });

        // Sync Settings
        onSnapshot(doc(db, "settings", "main"), (docSnap) => {
            if (docSnap.exists()) {
                window.settings = docSnap.data();
                applySettings();
            }
        });

        // Sync Orders
        onSnapshot(query(collection(db, "orders"), orderBy("timestamp", "desc")), (snapshot) => {
            window.historyData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderHistory();
        });

        window.addProduct = async () => {
            const name = document.getElementById('new-p-name').value;
            const price = document.getElementById('new-p-price').value;
            const cat = document.getElementById('new-p-cat').value || 'Geral';
            if(!name || !price) return alert("Preencha os campos!");
            try {
                await addDoc(collection(db, "products"), {
                    name, price, cat, 
                    img: window.currentProductImg || "", 
                    timestamp: serverTimestamp()
                });
                alert("Produto Adicionado!");
                document.getElementById('new-p-name').value = "";
                document.getElementById('new-p-price').value = "";
            } catch (e) { alert("Erro: " + e); }
        };

        window.deleteProduct = async (id) => {
            if(confirm("Apagar produto?")) await deleteDoc(doc(db, "products", id));
        };

        window.saveSettings = async () => {
            const data = {
                logo: document.getElementById('cfg-logo').value,
                title: document.getElementById('cfg-title').value,
                slogan: document.getElementById('cfg-slogan').value,
                logoImg: window.currentLogoImg || window.settings.logoImg || ""
            };
            await setDoc(doc(db, "settings", "main"), data);
            alert("Configura√ß√µes Salvas!");
        };

        window.confirmOrder = async () => {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const addr = document.getElementById('cust-address').value;
            if(!name || !phone || !addr) return alert("Preencha os dados!");

            const orderData = { 
                timestamp: serverTimestamp(),
                date: new Date().toLocaleString(), 
                customer: name, phone, address: addr,
                items: [...window.cart] 
            };
            await addDoc(collection(db, "orders"), orderData);

            let itensTexto = window.cart.map(i => `- ${i.name} (${i.price})`).join('%0A');
            const msg = `üöÄ *NOVO PEDIDO*%0A%0A*ITENS:*%0A${itensTexto}%0A%0A*CLIENTE:* ${name}%0A*ADDR:* ${addr}`;
            window.location.href = `https://wa.me/258845478417?text=${msg}`; 
            
            window.cart = [];
            updateCartUI();
            closeSheets();
        };

        window.renderMarketplace = (filteredCat = 'Todos') => {
            const list = document.getElementById('product-list');
            list.innerHTML = '';
            const displayProds = filteredCat === 'Todos' ? window.products : window.products.filter(p => p.cat === filteredCat);
            displayProds.forEach(p => {
                list.innerHTML += `
                    <div class="glass-product">
                        <div class="image-wrapper"><img src="${p.img || 'https://via.placeholder.com/150'}"></div>
                        <h2 style="font-size: 0.9rem;">${p.name}</h2>
                        <span class="mzn-price">${p.price}</span>
                        <button class="buy-btn" onclick="addToCart('${p.id}')">Adicionar</button>
                    </div>`;
            });
            const uniqueCats = ['Todos', ...new Set(window.products.map(p => p.cat))];
            document.getElementById('mkt-cats').innerHTML = uniqueCats.map(c => `
                <button class="cat-item ${filteredCat === c ? 'active' : ''}" onclick="renderMarketplace('${c}')">${c}</button>
            `).join('');
            updateDashboardStats();
        };

        window.renderAdminProducts = () => {
            document.getElementById('admin-product-list').innerHTML = window.products.map(p => `
                <div class="order-row">
                    <span style="font-size:0.8rem;">${p.name} <br><small>${p.cat}</small></span>
                    <button class="btn-del" onclick="deleteProduct('${p.id}')">Apagar</button>
                </div>
            `).join('');
            updateDashboardStats();
        };

        window.renderHistory = () => {
            const container = document.getElementById('admin-history-list');
            container.innerHTML = window.historyData.length ? window.historyData.map(h => `
                <div class="order-row" style="flex-direction:column; align-items:flex-start; gap: 5px;">
                    <div style="display:flex; justify-content:space-between; width:100%;">
                        <span style="font-size:0.7rem; opacity:0.6;">${h.date}</span>
                        <span style="font-size:0.7rem; font-weight:800; color:var(--orange);">${h.phone}</span>
                    </div>
                    <span style="font-weight:700;">${h.customer}</span>
                    <div style="font-size:0.7rem;">${h.items.map(i => `‚Ä¢ ${i.name}`).join('<br>')}</div>
                </div>
            `).join('') : '<p>Sem pedidos.</p>';
        };

        function applySettings() {
            document.getElementById('mkt-logo').innerText = window.settings.logo;
            document.getElementById('mkt-title').innerText = window.settings.title;
            document.getElementById('mkt-slogan').innerText = window.settings.slogan;
            if(window.settings.logoImg) document.getElementById('mkt-logo-img').src = window.settings.logoImg;
            document.getElementById('cfg-logo').value = window.settings.logo;
            document.getElementById('cfg-title').value = window.settings.title;
            document.getElementById('cfg-slogan').value = window.settings.slogan;
        }

        document.getElementById('new-p-file').onchange = e => {
            const reader = new FileReader();
            reader.onload = () => window.currentProductImg = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        };

        document.getElementById('cfg-file').onchange = e => {
            const reader = new FileReader();
            reader.onload = () => window.currentLogoImg = reader.result;
            reader.readAsDataURL(e.target.files[0]);
        };

        startClock();
    </script>

    <script>
        function updateCartUI() {
            const badge = document.getElementById('cart-badge');
            badge.innerText = window.cart.length;
            document.getElementById('cart-items-container').innerHTML = window.cart.map((item, i) => `
                <div class="cart-item-row">
                    <span>${item.name}</span>
                    <button onclick="removeFromCart(${i})" style="border:none; background:none; color:red;">X</button>
                </div>
            `).join('');
            document.getElementById('cart-total').innerText = "Total: " + window.cart.length + " itens";
        }

        function removeFromCart(i) { window.cart.splice(i, 1); updateCartUI(); }
        function addToCart(id) { const prod = window.products.find(p => p.id == id); if(prod) { window.cart.push(prod); updateCartUI(); } }
        function openSheet(id) { document.getElementById('body').classList.add('blurred'); document.getElementById(id).classList.add('active'); }
        function closeSheets() { document.getElementById('body').classList.remove('blurred'); document.querySelectorAll('.sheet').forEach(s => s.classList.remove('active')); }
        function toggleTheme() { 
            document.body.classList.toggle('dark-mode');
            const icon = document.getElementById('theme-icon');
            icon.setAttribute('data-lucide', document.body.classList.contains('dark-mode') ? 'sun' : 'moon');
            lucide.createIcons();
        }
        function startClock() { setInterval(() => { const el = document.getElementById('admin-clock'); if(el) el.innerText = new Date().toLocaleTimeString(); }, 1000); }
        
        function login() {
            const user = document.getElementById('adm-user').value;
            const pass = document.getElementById('adm-pass').value;
            if(user === 'kmcellshopp@gmail.com' && pass === 'admin123moz') {
                document.getElementById('admin-view').style.display = 'block'; 
                closeSheets();
                lucide.createIcons();
            } else {
                alert("Dados incorretos!");
            }
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => t.style.display = 'none');
            document.getElementById('tab-' + tab).style.display = 'block';
        }

        function closeAdmin() { document.getElementById('admin-view').style.display = 'none'; }
        function openWhatsAppSupport() { window.location.href = 'https://wa.me/258845478417'; }
        function goToCheckout() { if(window.cart.length > 0) { closeSheets(); openSheet('checkout-sheet'); } else alert("Carrinho vazio!"); }
        
        function updateDashboardStats() {
            if(document.getElementById('stat-prod-count')) {
                document.getElementById('stat-prod-count').innerText = window.products.length;
                const cats = [...new Set(window.products.map(p => p.cat))];
                document.getElementById('stat-cat-count').innerText = cats.length;
            }
        }
        
        lucide.createIcons();
    </script>
</body>
</html>
